<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BETA SMART FINANCE PRO v2.0 - ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÇÿ≥Ÿäÿ∑ ÿßŸÑŸÖÿ±ŸÜ ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ±</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap');
        * { 
            font-family: 'Cairo', sans-serif;
            box-sizing: border-box;
        }
        body { 
            margin: 0; 
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        @media print {
            body { 
                print-color-adjust: exact; 
                -webkit-print-color-adjust: exact; 
                margin: 0;
                padding: 0;
                background: white !important;
            }
            .print-hidden { display: none !important; }
            .print-only { display: block !important; }
            .print-container { 
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 20mm !important;
                background: white !important;
            }
            @page {
                size: A4;
                margin: 15mm;
            }
            .glass-card {
                background: white !important;
                border: 1px solid #ccc !important;
            }
        }
        
        .print-only { display: none; }
        
        /* Modern Glassmorphism Effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-dark {
            background: rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }
        
        /* Premium Gradient Backgrounds */
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .gradient-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        /* Modern Input Styles */
        .modern-input {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .modern-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .modern-input:hover {
            border-color: #a5b4fc;
        }
        
        /* Premium Button Styles */
        .btn-premium {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn-premium::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-premium:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        /* Modern Badge Styles */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-pro {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .badge-new {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-slide-in { animation: slideIn 0.4s ease-out; }

        .comparison-table td, .comparison-table th {
            padding: 12px;
            border: 1px solid #e5e7eb;
        }
        
        .comparison-highlight-positive {
            background-color: #d1fae5;
            font-weight: bold;
        }
        
        .comparison-highlight-negative {
            background-color: #fee2e2;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // BETA SMART FINANCE ENGINE - FLEXIBLE PAYMENT SYSTEM
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        class SmartPaymentEngine {
            constructor(unitValue, cashDiscountRate, discountRate, baseDate = new Date()) {
                this.unitValue = unitValue;
                this.cashDiscountRate = cashDiscountRate / 100;
                this.discountRate = discountRate / 100;
                this.cashValue = unitValue * (1 - this.cashDiscountRate);
                this.baseDate = new Date(baseDate);
                this.baseDate.setHours(0, 0, 0, 0);
            }

            // ‚ïê‚ïê‚ïê XNPV IMPLEMENTATION ‚ïê‚ïê‚ïê
            calculateXNPV(rate, cashFlows) {
                if (cashFlows.length === 0) return 0;
                
                return cashFlows.reduce((npv, cf) => {
                    const cfDate = new Date(cf.date);
                    cfDate.setHours(0, 0, 0, 0);
                    
                    const days = Math.round((cfDate - this.baseDate) / (1000 * 60 * 60 * 24));
                    const years = days / 365;
                    
                    if (days <= 0) {
                        return npv + cf.amount;
                    }
                    
                    return npv + cf.amount / Math.pow(1 + rate, years);
                }, 0);
            }

            calculatePVWithDate(amount, paymentDate) {
                const payment = new Date(paymentDate);
                payment.setHours(0, 0, 0, 0);
                const days = Math.round((payment - this.baseDate) / (1000 * 60 * 60 * 24));
                const years = days / 365;
                
                if (days <= 0) {
                    return amount;
                }
                
                return amount / Math.pow(1 + this.discountRate, years);
            }

            addMonths(date, months) {
                const d = new Date(date);
                d.setMonth(d.getMonth() + months);
                return d;
            }

            // ‚ïê‚ïê‚ïê FIND EQUAL INSTALLMENT ‚ïê‚ïê‚ïê
            findEqualInstallmentXNPV(targetPV, dates) {
                let low = 0, high = targetPV * 2, tolerance = 0.1;
                const maxIterations = 100;
                let iterations = 0;

                while (high - low > tolerance && iterations < maxIterations) {
                    const mid = (low + high) / 2;
                    
                    let calculatedPV = 0;
                    for (let i = 0; i < dates.length; i++) {
                        calculatedPV += this.calculatePVWithDate(mid, dates[i]);
                    }
                    
                    if (calculatedPV < targetPV) {
                        low = mid;
                    } else {
                        high = mid;
                    }
                    
                    iterations++;
                }
                
                return (low + high) / 2;
            }

            // ‚ïê‚ïê‚ïê EQUAL INSTALLMENTS ‚ïê‚ïê‚ïê
            calculateEqualInstallments(params) {
                const {
                    downPayment,
                    downPaymentDate,
                    numberOfYears,
                    frequency = 4,
                    annualPayments = [],
                    semiannualPayments = [],
                    quarterlyPayments = [],
                    quarterlyStartDate = null
                } = params;
                
                const basePaymentDate = downPaymentDate || this.baseDate;
                
                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'ŸÖŸÇÿØŸÖ',
                    date: basePaymentDate.toISOString().split('T')[0],
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿØŸÅÿπÿßÿ™ ÿßŸÑÿ≥ŸÜŸàŸäÿ©
                annualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date || this.addMonths(basePaymentDate, (index + 1) * 12);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ© ${index + 1}`,
                        date: paymentDate.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿØŸÅÿπÿßÿ™ ÿßŸÑŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ©
                semiannualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date || this.addMonths(basePaymentDate, (index + 1) * 6);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ© ${index + 1}`,
                        date: paymentDate.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿØŸÅÿπÿßÿ™ ÿßŸÑÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ© (ÿßŸÑŸÖÿ≠ÿØÿØÿ©)
                quarterlyPayments.forEach((payment, index) => {
                    const paymentDate = payment.date || this.addMonths(basePaymentDate, (index + 1) * 3);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `ÿØŸÅÿπÿ© ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ© ${index + 1}`,
                        date: paymentDate.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const remainingPV = this.cashValue - knownPV;
                const startDate = quarterlyStartDate ? new Date(quarterlyStartDate) : this.addMonths(basePaymentDate, 3);
                
                const numberOfQuarters = numberOfYears * frequency;
                const quarterlyDates = [];
                for (let i = 0; i < numberOfQuarters; i++) {
                    quarterlyDates.push(this.addMonths(startDate, i * (12 / frequency)));
                }

                const installmentAmount = this.findEqualInstallmentXNPV(remainingPV, quarterlyDates);

                quarterlyDates.forEach((date, index) => {
                    const pv = this.calculatePVWithDate(installmentAmount, date);
                    schedule.push({
                        id: paymentId++,
                        type: `ŸÇÿ≥ÿ∑ ŸÖŸàÿ≠ÿØ ${index + 1}`,
                        date: date.toISOString().split('T')[0],
                        amount: installmentAmount,
                        pv,
                        discount: installmentAmount - pv
                    });
                });

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'equal',
                    patternName: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÇÿ≥ÿ∑ ÿßŸÑŸÖŸàÿ≠ÿØ',
                    downPayment,
                    installmentAmount,
                    numberOfInstallments: quarterlyDates.length,
                    annualPayments: annualPayments.length,
                    semiannualPayments: semiannualPayments.length,
                    quarterlyPayments: quarterlyPayments.length,
                    frequency,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            // ‚ïê‚ïê‚ïê DECREASING PAYMENTS ‚ïê‚ïê‚ïê
            calculateDecreasingPayments(params) {
                const {
                    downPayment,
                    numberOfYears,
                    frequency = 4,
                    decreaseRate = 2,
                    annualPayments = [],
                    semiannualPayments = [],
                    quarterlyStartDate = null
                } = params;

                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'ŸÖŸÇÿØŸÖ',
                    date: this.baseDate.toISOString().split('T')[0],
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                annualPayments.forEach((payment, index) => {
                    const paymentDate = new Date(payment.date);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ© ${index + 1}`,
                        date: paymentDate.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                semiannualPayments.forEach((payment, index) => {
                    const paymentDate = new Date(payment.date);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ© ${index + 1}`,
                        date: paymentDate.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const remainingPV = this.cashValue - knownPV;
                const startDate = quarterlyStartDate ? new Date(quarterlyStartDate) : this.addMonths(this.baseDate, 3);
                
                const numberOfQuarters = numberOfYears * frequency;
                const quarterlyDates = [];
                for (let i = 0; i < numberOfQuarters; i++) {
                    quarterlyDates.push(this.addMonths(startDate, i * (12 / frequency)));
                }

                const baseInstallment = this.findBaseInstallmentDecreasing(remainingPV, quarterlyDates, decreaseRate / 100);

                quarterlyDates.forEach((date, index) => {
                    const amount = baseInstallment * Math.pow(1 - decreaseRate / 100, index);
                    const pv = this.calculatePVWithDate(amount, date);
                    schedule.push({
                        id: paymentId++,
                        type: `ŸÇÿ≥ÿ∑ ŸÖÿ™ŸÜÿßŸÇÿµ ${index + 1}`,
                        date: date.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'decreasing',
                    patternName: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑ ÿßŸÑŸÖÿ™ŸÜÿßŸÇÿµÿ©',
                    downPayment,
                    baseInstallment,
                    decreaseRate,
                    numberOfInstallments: quarterlyDates.length,
                    annualPayments: annualPayments.length,
                    semiannualPayments: semiannualPayments.length,
                    frequency,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            findBaseInstallmentDecreasing(targetPV, dates, decreaseRate) {
                let low = 0, high = targetPV * 2, tolerance = 0.1;
                const maxIterations = 100;
                let iterations = 0;

                while (high - low > tolerance && iterations < maxIterations) {
                    const mid = (low + high) / 2;
                    
                    let calculatedPV = 0;
                    for (let i = 0; i < dates.length; i++) {
                        const amount = mid * Math.pow(1 - decreaseRate, i);
                        calculatedPV += this.calculatePVWithDate(amount, dates[i]);
                    }
                    
                    if (calculatedPV < targetPV) {
                        low = mid;
                    } else {
                        high = mid;
                    }
                    
                    iterations++;
                }
                
                return (low + high) / 2;
            }

            // ‚ïê‚ïê‚ïê GRADUATED PAYMENTS ‚ïê‚ïê‚ïê
            calculateGraduatedPayments(params) {
                const {
                    downPayment,
                    numberOfYears,
                    frequency = 4,
                    growthRate = 3,
                    annualPayments = [],
                    semiannualPayments = [],
                    quarterlyStartDate = null
                } = params;

                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'ŸÖŸÇÿØŸÖ',
                    date: this.baseDate.toISOString().split('T')[0],
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                annualPayments.forEach((payment, index) => {
                    const paymentDate = new Date(payment.date);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ© ${index + 1}`,
                        date: paymentDate.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                semiannualPayments.forEach((payment, index) => {
                    const paymentDate = new Date(payment.date);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ© ${index + 1}`,
                        date: paymentDate.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const remainingPV = this.cashValue - knownPV;
                const startDate = quarterlyStartDate ? new Date(quarterlyStartDate) : this.addMonths(this.baseDate, 3);
                
                const numberOfQuarters = numberOfYears * frequency;
                const quarterlyDates = [];
                for (let i = 0; i < numberOfQuarters; i++) {
                    quarterlyDates.push(this.addMonths(startDate, i * (12 / frequency)));
                }

                const baseInstallment = this.findBaseInstallmentGraduated(remainingPV, quarterlyDates, growthRate / 100);

                quarterlyDates.forEach((date, index) => {
                    const amount = baseInstallment * Math.pow(1 + growthRate / 100, index);
                    const pv = this.calculatePVWithDate(amount, date);
                    schedule.push({
                        id: paymentId++,
                        type: `ŸÇÿ≥ÿ∑ ŸÖÿ™ÿ≤ÿßŸäÿØ ${index + 1}`,
                        date: date.toISOString().split('T')[0],
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'graduated',
                    patternName: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑ ÿßŸÑŸÖÿ™ÿ≤ÿßŸäÿØÿ©',
                    downPayment,
                    baseInstallment,
                    growthRate,
                    numberOfInstallments: quarterlyDates.length,
                    annualPayments: annualPayments.length,
                    semiannualPayments: semiannualPayments.length,
                    frequency,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            findBaseInstallmentGraduated(targetPV, dates, growthRate) {
                let low = 0, high = targetPV * 2, tolerance = 0.1;
                const maxIterations = 100;
                let iterations = 0;

                while (high - low > tolerance && iterations < maxIterations) {
                    const mid = (low + high) / 2;
                    
                    let calculatedPV = 0;
                    for (let i = 0; i < dates.length; i++) {
                        const amount = mid * Math.pow(1 + growthRate, i);
                        calculatedPV += this.calculatePVWithDate(amount, dates[i]);
                    }
                    
                    if (calculatedPV < targetPV) {
                        low = mid;
                    } else {
                        high = mid;
                    }
                    
                    iterations++;
                }
                
                return (low + high) / 2;
            }

            // ‚ïê‚ïê‚ïê CUSTOM DISTRIBUTION ‚ïê‚ïê‚ïê
            calculateCustomDistribution(params) {
                const {
                    downPayment,
                    customPayments = [],
                    quarterlyYears = 0,
                    quarterlyStartDate = null
                } = params;
                
                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'ŸÖŸÇÿØŸÖ',
                    date: this.baseDate.toISOString().split('T')[0],
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                customPayments.forEach((payment) => {
                    const baseAmount = payment.amount;

                    if (payment.frequency === 'once') {
                        const paymentDate = new Date(payment.startDate);
                        const pv = this.calculatePVWithDate(baseAmount, paymentDate);
                        knownPV += pv;
                        
                        schedule.push({
                            id: paymentId++,
                            type: payment.type || 'ÿØŸÅÿπÿ©',
                            date: paymentDate.toISOString().split('T')[0],
                            amount: baseAmount,
                            pv,
                            discount: baseAmount - pv
                        });
                    } else {
                        const monthsInterval = payment.frequency === 'annual' ? 12 : 6;
                        const numberOfPayments = payment.numberOfPayments || 1;
                        
                        for (let i = 0; i < numberOfPayments; i++) {
                            const paymentDate = this.addMonths(new Date(payment.startDate), i * monthsInterval);
                            const pv = this.calculatePVWithDate(baseAmount, paymentDate);
                            knownPV += pv;
                            
                            schedule.push({
                                id: paymentId++,
                                type: `${payment.type || 'ÿØŸÅÿπÿ©'} ${i + 1}`,
                                date: paymentDate.toISOString().split('T')[0],
                                amount: baseAmount,
                                pv,
                                discount: baseAmount - pv
                            });
                        }
                    }
                });

                if (quarterlyYears > 0) {
                    const remainingPV = this.cashValue - knownPV;
                    const startDate = quarterlyStartDate ? new Date(quarterlyStartDate) : this.addMonths(this.baseDate, 3);
                    
                    const numberOfQuarters = quarterlyYears * 4;
                    const quarterlyDates = [];
                    for (let i = 0; i < numberOfQuarters; i++) {
                        quarterlyDates.push(this.addMonths(startDate, i * 3));
                    }

                    const quarterlyInstallment = this.findEqualInstallmentXNPV(remainingPV, quarterlyDates);

                    quarterlyDates.forEach((date, index) => {
                        const pv = this.calculatePVWithDate(quarterlyInstallment, date);
                        schedule.push({
                            id: paymentId++,
                            type: `ŸÇÿ≥ÿ∑ ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸä ${index + 1}`,
                            date: date.toISOString().split('T')[0],
                            amount: quarterlyInstallment,
                            pv,
                            discount: quarterlyInstallment - pv
                        });
                    });
                }

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'custom',
                    patternName: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÖÿÆÿµÿµ',
                    downPayment,
                    customPayments,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            // ‚ïê‚ïê‚ïê BASE SYSTEM ‚ïê‚ïê‚ïê
            calculateBaseSystem(baseSystemConfig, unitValue) {
                if (!baseSystemConfig) return null;

                const downPaymentDate = baseSystemConfig.downPaymentDate 
                    ? new Date(baseSystemConfig.downPaymentDate) 
                    : this.baseDate;

                const downPayment = baseSystemConfig.downPaymentIsPercentage 
                    ? unitValue * (baseSystemConfig.downPaymentValue / 100)
                    : baseSystemConfig.downPaymentValue;

                const annualPayments = (baseSystemConfig.annualPayments || []).map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date ? new Date(p.date) : null
                }));

                const semiannualPayments = (baseSystemConfig.semiannualPayments || []).map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date ? new Date(p.date) : null
                }));

                const quarterlyPayments = (baseSystemConfig.quarterlyPayments || []).map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date ? new Date(p.date) : null
                }));

                return this.calculateEqualInstallments({
                    downPayment,
                    downPaymentDate,
                    numberOfYears: baseSystemConfig.quarterlyYears,
                    frequency: 4,
                    annualPayments,
                    semiannualPayments,
                    quarterlyPayments,
                    quarterlyStartDate: null
                });
            }

            // ‚ïê‚ïê‚ïê IMPLIED DISCOUNT RATE ‚ïê‚ïê‚ïê
            calculateImpliedDiscountRate(baseSystem, unitValue) {
                const targetPV = this.cashValue;
                const payments = [];
                
                const downPaymentDate = baseSystem.downPaymentDate 
                    ? new Date(baseSystem.downPaymentDate) 
                    : this.baseDate;
                
                const downPayment = baseSystem.downPaymentIsPercentage 
                    ? unitValue * (baseSystem.downPaymentValue / 100)
                    : baseSystem.downPaymentValue;
                    
                payments.push({ amount: downPayment, date: downPaymentDate });
                
                // ÿßŸÑÿØŸÅÿπÿßÿ™ ÿßŸÑÿ≥ŸÜŸàŸäÿ©
                if (baseSystem.annualPayments && baseSystem.annualPayments.length > 0) {
                    baseSystem.annualPayments.forEach((payment, index) => {
                        const date = payment.date 
                            ? new Date(payment.date) 
                            : this.addMonths(downPaymentDate, (index + 1) * 12);
                        const amount = payment.isPercentage 
                            ? unitValue * (payment.value / 100)
                            : payment.value;
                        payments.push({ amount, date });
                    });
                }

                // ÿßŸÑÿØŸÅÿπÿßÿ™ ŸÜÿµŸÅ ÿßŸÑÿ≥ŸÜŸàŸäÿ©
                if (baseSystem.semiannualPayments && baseSystem.semiannualPayments.length > 0) {
                    baseSystem.semiannualPayments.forEach((payment, index) => {
                        const date = payment.date 
                            ? new Date(payment.date) 
                            : this.addMonths(downPaymentDate, (index + 1) * 6);
                        const amount = payment.isPercentage 
                            ? unitValue * (payment.value / 100)
                            : payment.value;
                        payments.push({ amount, date });
                    });
                }

                // ÿßŸÑÿØŸÅÿπÿßÿ™ ÿßŸÑÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©
                if (baseSystem.quarterlyPayments && baseSystem.quarterlyPayments.length > 0) {
                    baseSystem.quarterlyPayments.forEach((payment, index) => {
                        const date = payment.date 
                            ? new Date(payment.date) 
                            : this.addMonths(downPaymentDate, (index + 1) * 3);
                        const amount = payment.isPercentage 
                            ? unitValue * (payment.value / 100)
                            : payment.value;
                        payments.push({ amount, date });
                    });
                }
                
                let knownAmount = payments.reduce((sum, p) => sum + p.amount, 0);
                let remainingAmount = unitValue - knownAmount;
                
                const numberOfQuarters = baseSystem.quarterlyYears * 4;
                const quarterlyAmount = remainingAmount / numberOfQuarters;
                
                for (let i = 0; i < numberOfQuarters; i++) {
                    const date = this.addMonths(downPaymentDate, (i + 1) * 3);
                    payments.push({ amount: quarterlyAmount, date });
                }
                
                return this.findDiscountRateXNPV(payments, targetPV);
            }

            findDiscountRateXNPV(payments, targetPV, tolerance = 0.00001) {
                let lowRate = 0.00;
                let highRate = 0.50;
                let iterations = 0;
                const maxIterations = 100;
                
                const cashFlows = payments.map(p => ({
                    date: p.date,
                    amount: p.amount
                }));

                while (highRate - lowRate > tolerance && iterations < maxIterations) {
                    const midRate = (lowRate + highRate) / 2;
                    
                    const calculatedPV = this.calculateXNPV(midRate, cashFlows);
                    
                    if (calculatedPV < targetPV) {
                        highRate = midRate;
                    } else {
                        lowRate = midRate;
                    }
                    
                    iterations++;
                }
                
                const finalRate = (lowRate + highRate) / 2;
                return finalRate * 100;
            }

            // ‚ïê‚ïê‚ïê VERIFICATION ‚ïê‚ïê‚ïê
            verifyScheduleXNPV(schedule) {
                const cashFlows = schedule.map(p => ({
                    date: new Date(p.date),
                    amount: p.amount
                }));

                const totalPV = this.calculateXNPV(this.discountRate, cashFlows);
                const totalPaid = schedule.reduce((sum, payment) => sum + payment.amount, 0);
                const difference = totalPV - this.cashValue;
                const percentDiff = (difference / this.cashValue) * 100;
                
                return {
                    totalPV,
                    totalPaid,
                    cashValue: this.cashValue,
                    difference,
                    percentDiff,
                    status: Math.abs(difference) < 1000 ? 'ŸÖÿ∑ÿßÿ®ŸÇ ‚úÖ' : 'ÿ∫Ÿäÿ± ŸÖÿ∑ÿßÿ®ŸÇ ‚ùå',
                    accuracy: Math.abs(percentDiff) < 0.1 ? 'ÿØŸÇÿ© ÿπÿßŸÑŸäÿ©' : 'Ÿäÿ≠ÿ™ÿßÿ¨ ÿ™ÿπÿØŸäŸÑ'
                };
            }

            calculateSummary(schedule) {
                const totalPaid = schedule.reduce((sum, p) => sum + p.amount, 0);
                const totalPV = schedule.reduce((sum, p) => sum + p.pv, 0);
                const totalDiscount = schedule.reduce((sum, p) => sum + p.discount, 0);
                
                return {
                    numberOfPayments: schedule.length,
                    totalPaid,
                    totalPV,
                    totalDiscount,
                    effectiveInterestRate: ((totalPaid - this.cashValue) / this.cashValue) * 100,
                    averagePayment: totalPaid / schedule.length
                };
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // BETA SMART FINANCE - ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÇÿ≥Ÿäÿ∑ ÿßŸÑŸÖÿ±ŸÜ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function BetaSmartFinance() {
            const [isAdmin, setIsAdmin] = useState(false);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const ADMIN_PASSWORD = 'beta2025';

            const [projects, setProjects] = useState(() => {
                const saved = localStorage.getItem('betaProjects_final');
                return saved ? JSON.parse(saved) : [
                    { 
                        id: 1, 
                        name: 'ÿ®Ÿäÿ™ÿß ÿ¨ÿ±ŸäŸÜÿ≤ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ', 
                        cashDiscountRate: 40, 
                        discountRate: 17.1709,
                        discountRateMode: 'manual',
                        baseSystem: {
                            downPaymentValue: 10,
                            downPaymentIsPercentage: true,
                            downPaymentDate: null,
                            annualPayments: [],
                            semiannualPayments: [],
                            quarterlyPayments: [],
                            quarterlyYears: 8
                        },
                        description: 'ŸÖÿ¥ÿ±Ÿàÿπ ÿ≥ŸÉŸÜŸä ŸÖÿ™ŸÉÿßŸÖŸÑ', 
                        color: 'emerald' 
                    },
                    { 
                        id: 2, 
                        name: 'ÿ®Ÿäÿ™ÿß ÿ±Ÿäÿ≤ŸäÿØŸÜÿ≥ ÿ£ŸÉÿ™Ÿàÿ®ÿ±', 
                        cashDiscountRate: 30, 
                        discountRate: 13.643,
                        discountRateMode: 'manual',
                        baseSystem: {
                            downPaymentValue: 15,
                            downPaymentIsPercentage: true,
                            downPaymentDate: null,
                            annualPayments: [{ value: 10, isPercentage: true, type: 'ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ©', date: null }],
                            semiannualPayments: [],
                            quarterlyPayments: [],
                            quarterlyYears: 8
                        },
                        description: 'ŸÖÿ¨ŸÖÿπ ÿ≥ŸÉŸÜŸä ŸÅÿßÿÆÿ±', 
                        color: 'blue' 
                    },
                ];
            });

            useEffect(() => {
                localStorage.setItem('betaProjects_final', JSON.stringify(projects));
            }, [projects]);

            const [showProjectsManager, setShowProjectsManager] = useState(false);
            const [editingProject, setEditingProject] = useState(null);
            const [selectedProjectId, setSelectedProjectId] = useState(1);
            
            const [showBaseSystemModal, setShowBaseSystemModal] = useState(false);
            const [currentProjectForBaseSystem, setCurrentProjectForBaseSystem] = useState(null);
            const [tempBaseSystem, setTempBaseSystem] = useState({
                downPaymentValue: 10,
                downPaymentIsPercentage: true,
                annualPayments: [],
                semiannualPayments: [],
                quarterlyPayments: [],
                quarterlyYears: 8,
                startDate: ''
            });
            
            const [unitValue, setUnitValue] = useState(10000000);
            const [unitNumber, setUnitNumber] = useState('');
            const [selectedPattern, setSelectedPattern] = useState('equal');
            
            const [downPaymentValue, setDownPaymentValue] = useState(10);
            const [downPaymentIsPercentage, setDownPaymentIsPercentage] = useState(true);
            const [numberOfYears, setNumberOfYears] = useState(8);
            const [frequency, setFrequency] = useState(4);
            const [annualPayments, setAnnualPayments] = useState([]);
            const [semiannualPayments, setSemiannualPayments] = useState([]);
            const [quarterlyStartDate, setQuarterlyStartDate] = useState('');
            
            const [decreaseRate, setDecreaseRate] = useState(2);
            const [growthRate, setGrowthRate] = useState(3);
            
            const [customPayments, setCustomPayments] = useState([]);
            const [quarterlyYears, setQuarterlyYears] = useState(8);
            const [customQuarterlyStartDate, setCustomQuarterlyStartDate] = useState('');
            
            const [results, setResults] = useState(null);
            const [baseSystemResults, setBaseSystemResults] = useState(null);
            const [showComparison, setShowComparison] = useState(false);
            const [comparisonView, setComparisonView] = useState('summary');

            const patterns = [
                { id: 'equal', name: 'ŸÇÿ≥ÿ∑ ŸÖŸàÿ≠ÿØ', description: 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑ ÿ®ŸÜŸÅÿ≥ ÿßŸÑŸÇŸäŸÖÿ©', color: 'blue', icon: '‚öñÔ∏è' },
                { id: 'decreasing', name: 'ÿ£ŸÇÿ≥ÿßÿ∑ ŸÖÿ™ŸÜÿßŸÇÿµÿ©', description: 'ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑ ÿ™ÿ™ŸÜÿßŸÇÿµ ŸÖÿπ ÿßŸÑŸàŸÇÿ™', color: 'emerald', icon: 'üìâ' },
                { id: 'graduated', name: 'ÿ£ŸÇÿ≥ÿßÿ∑ ŸÖÿ™ÿ≤ÿßŸäÿØÿ©', description: 'ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑ ÿ™ÿ≤ŸäÿØ ŸÖÿπ ÿßŸÑŸàŸÇÿ™', color: 'purple', icon: 'üìà' },
                { id: 'custom', name: 'ÿ™Ÿàÿ≤Ÿäÿπ ŸÖÿÆÿµÿµ', description: 'ÿ£ŸÜÿ™ ÿ™ÿ≠ÿØÿØ ÿßŸÑÿØŸÅÿπÿßÿ™', color: 'amber', icon: '‚ö°' },
            ];

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('ar-EG', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(value) + ' ÿ¨';
            };

            const formatDate = (dateString) => {
                return new Date(dateString).toLocaleDateString('ar-EG', {
                    year: 'numeric', month: 'long', day: 'numeric'
                });
            };

            const getSelectedProject = () => projects.find(p => p.id === selectedProjectId);

            const handlePrint = () => {
                window.print();
            };

            const calculateDownPayment = () => {
                return downPaymentIsPercentage 
                    ? unitValue * (downPaymentValue / 100)
                    : downPaymentValue;
            };

            useEffect(() => {
                const project = getSelectedProject();
                if (project && project.baseSystem && unitValue > 0) {
                    if (selectedPattern === 'equal' || selectedPattern === 'decreasing' || selectedPattern === 'graduated') {
                        setDownPaymentValue(project.baseSystem.downPaymentValue);
                        setDownPaymentIsPercentage(project.baseSystem.downPaymentIsPercentage);
                        setNumberOfYears(project.baseSystem.quarterlyYears);
                        
                        if (project.baseSystem.annualPayments && project.baseSystem.annualPayments.length > 0) {
                            const today = new Date();
                            const formattedPayments = project.baseSystem.annualPayments.map((p, index) => {
                                const paymentDate = new Date(today);
                                paymentDate.setFullYear(today.getFullYear() + index + 1);
                                return {
                                    id: Date.now() + index,
                                    type: p.type || 'ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ©',
                                    value: p.value,
                                    isPercentage: p.isPercentage,
                                    date: paymentDate.toISOString().split('T')[0]
                                };
                            });
                            setAnnualPayments(formattedPayments);
                        } else {
                            setAnnualPayments([]);
                        }

                        if (project.baseSystem.semiannualPayments && project.baseSystem.semiannualPayments.length > 0) {
                            const today = new Date();
                            const formattedPayments = project.baseSystem.semiannualPayments.map((p, index) => {
                                const paymentDate = new Date(today);
                                paymentDate.setMonth(today.getMonth() + (index + 1) * 6);
                                return {
                                    id: Date.now() + index + 1000,
                                    type: p.type || 'ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ©',
                                    value: p.value,
                                    isPercentage: p.isPercentage,
                                    date: paymentDate.toISOString().split('T')[0]
                                };
                            });
                            setSemiannualPayments(formattedPayments);
                        } else {
                            setSemiannualPayments([]);
                        }
                    }
                }
            }, [selectedProjectId, selectedPattern, unitValue]);

            const openBaseSystemModal = (projectId) => {
                const project = projects.find(p => p.id === projectId);
                setCurrentProjectForBaseSystem(project);
                
                if (project.baseSystem) {
                    setTempBaseSystem({
                        ...project.baseSystem,
                        quarterlyPayments: project.baseSystem.quarterlyPayments || [],
                        startDate: project.baseSystem.startDate || ''
                    });
                } else {
                    setTempBaseSystem({
                        downPaymentValue: 10,
                        downPaymentIsPercentage: true,
                        annualPayments: [],
                        semiannualPayments: [],
                        quarterlyPayments: [],
                        quarterlyYears: 8,
                        startDate: ''
                    });
                }
                
                setShowBaseSystemModal(true);
            };

            const calculateDiscountRateForProject = () => {
                if (!currentProjectForBaseSystem) return;
                
                if (!unitValue || unitValue <= 0) {
                    alert('‚ö†Ô∏è Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÇŸäŸÖÿ© ÿßŸÑŸàÿ≠ÿØÿ© ÿ£ŸàŸÑÿßŸã');
                    return;
                }

                const engine = new SmartPaymentEngine(
                    unitValue, 
                    currentProjectForBaseSystem.cashDiscountRate, 
                    14,
                    new Date()
                );
                
                const impliedRate = engine.calculateImpliedDiscountRate(tempBaseSystem, unitValue);
                
                const updatedProjects = projects.map(p => {
                    if (p.id === currentProjectForBaseSystem.id) {
                        return {
                            ...p,
                            discountRate: impliedRate,
                            discountRateMode: 'auto',
                            baseSystem: tempBaseSystem
                        };
                    }
                    return p;
                });
                
                setProjects(updatedProjects);
                setShowBaseSystemModal(false);
                
                alert(`‚úÖ ÿ™ŸÖ ÿ≠ÿ≥ÿßÿ® ŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ ŸÑŸÑŸÖÿ¥ÿ±Ÿàÿπ "${currentProjectForBaseSystem.name}"!\n\nŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ®: ${impliedRate.toFixed(3)}%\n\nÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ŸÖÿπ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ.`);
            };

            const addProject = () => {
                const newProject = {
                    id: Date.now(),
                    name: 'ŸÖÿ¥ÿ±Ÿàÿπ ÿ¨ÿØŸäÿØ',
                    cashDiscountRate: 30,
                    discountRate: 14.643,
                    discountRateMode: 'manual',
                    baseSystem: {
                        downPaymentValue: 10,
                        downPaymentIsPercentage: true,
                        annualPayments: [],
                        semiannualPayments: [],
                        quarterlyYears: 8
                    },
                    description: 'ŸàÿµŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ',
                    color: 'indigo'
                };
                setProjects([...projects, newProject]);
                setEditingProject(newProject.id);
            };

            const deleteProject = (projectId) => {
                if (projects.length === 1) {
                    alert('ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ ÿ¢ÿÆÿ± ŸÖÿ¥ÿ±Ÿàÿπ!');
                    return;
                }
                if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπÿü')) {
                    setProjects(projects.filter(p => p.id !== projectId));
                    if (selectedProjectId === projectId) {
                        setSelectedProjectId(projects.find(p => p.id !== projectId).id);
                    }
                }
            };

            const updateProject = (projectId, field, value) => {
                setProjects(projects.map(p => 
                    p.id === projectId ? { ...p, [field]: value } : p
                ));
            };

            const addAnnualPayment = () => {
                const today = new Date();
                const defaultDate = new Date(today);
                defaultDate.setFullYear(today.getFullYear() + 1);
                
                setAnnualPayments([...annualPayments, {
                    id: Date.now(),
                    type: 'ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ©',
                    value: 10,
                    isPercentage: true,
                    date: defaultDate.toISOString().split('T')[0]
                }]);
            };

            const updateAnnualPayment = (id, field, value) => {
                setAnnualPayments(annualPayments.map(p =>
                    p.id === id ? { ...p, [field]: value } : p
                ));
            };

            const deleteAnnualPayment = (id) => {
                setAnnualPayments(annualPayments.filter(p => p.id !== id));
            };

            const addSemiannualPayment = () => {
                const today = new Date();
                const defaultDate = new Date(today);
                defaultDate.setMonth(today.getMonth() + 6);
                
                setSemiannualPayments([...semiannualPayments, {
                    id: Date.now(),
                    type: 'ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ©',
                    value: 5,
                    isPercentage: true,
                    date: defaultDate.toISOString().split('T')[0]
                }]);
            };

            const updateSemiannualPayment = (id, field, value) => {
                setSemiannualPayments(semiannualPayments.map(p =>
                    p.id === id ? { ...p, [field]: value } : p
                ));
            };

            const deleteSemiannualPayment = (id) => {
                setSemiannualPayments(semiannualPayments.filter(p => p.id !== id));
            };

            const addCustomPayment = () => {
                const today = new Date();
                const defaultDate = new Date(today);
                defaultDate.setFullYear(today.getFullYear() + 1);
                
                setCustomPayments([...customPayments, {
                    id: Date.now(),
                    type: 'ÿØŸÅÿπÿ© ŸÖÿÆÿµÿµÿ©',
                    value: 100000,
                    isPercentage: false,
                    frequency: 'once',
                    numberOfPayments: 1,
                    startDate: defaultDate.toISOString().split('T')[0]
                }]);
            };

            const updateCustomPayment = (id, field, value) => {
                setCustomPayments(customPayments.map(p =>
                    p.id === id ? { ...p, [field]: value } : p
                ));
            };

            const deleteCustomPayment = (id) => {
                setCustomPayments(customPayments.filter(p => p.id !== id));
            };

            const calculateResults = () => {
                const project = getSelectedProject();
                if (!project) return;

                const engine = new SmartPaymentEngine(
                    unitValue, 
                    project.cashDiscountRate, 
                    project.discountRate,
                    new Date()
                );
                
                let result = null;
                const downPayment = calculateDownPayment();

                const annualPaymentsProcessed = annualPayments.map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date
                }));

                const semiannualPaymentsProcessed = semiannualPayments.map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date
                }));

                const commonParams = {
                    downPayment,
                    numberOfYears,
                    frequency,
                    annualPayments: annualPaymentsProcessed,
                    semiannualPayments: semiannualPaymentsProcessed,
                    quarterlyStartDate: quarterlyStartDate || null
                };

                switch (selectedPattern) {
                    case 'equal':
                        result = engine.calculateEqualInstallments(commonParams);
                        break;
                    case 'decreasing':
                        result = engine.calculateDecreasingPayments({
                            ...commonParams,
                            decreaseRate
                        });
                        break;
                    case 'graduated':
                        result = engine.calculateGraduatedPayments({
                            ...commonParams,
                            growthRate
                        });
                        break;
                    case 'custom':
                        const customPaymentsProcessed = customPayments.map(p => ({
                            type: p.type,
                            amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                            frequency: p.frequency,
                            numberOfPayments: p.numberOfPayments,
                            startDate: p.startDate
                        }));
                        
                        result = engine.calculateCustomDistribution({
                            downPayment,
                            customPayments: customPaymentsProcessed,
                            quarterlyYears,
                            quarterlyStartDate: customQuarterlyStartDate || null
                        });
                        break;
                }

                setResults(result);

                if (project.baseSystem) {
                    const baseEngine = new SmartPaymentEngine(
                        unitValue, 
                        project.cashDiscountRate, 
                        project.discountRate,
                        new Date()
                    );
                    const baseResult = baseEngine.calculateBaseSystem(project.baseSystem, unitValue);
                    setBaseSystemResults(baseResult);
                }
            };

            const handleAdminLogin = () => {
                if (adminPassword === ADMIN_PASSWORD) {
                    setIsAdmin(true);
                    setShowAdminPanel(false);
                    setAdminPassword('');
                } else {
                    alert('ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿÆÿßÿ∑ÿ¶ÿ©');
                }
            };

            useEffect(() => {
                if (!quarterlyStartDate) {
                    const today = new Date();
                    const defaultDate = new Date(today);
                    defaultDate.setMonth(today.getMonth() + 3);
                    setQuarterlyStartDate(defaultDate.toISOString().split('T')[0]);
                }
                if (!customQuarterlyStartDate) {
                    const today = new Date();
                    const defaultDate = new Date(today);
                    defaultDate.setMonth(today.getMonth() + 3);
                    setCustomQuarterlyStartDate(defaultDate.toISOString().split('T')[0]);
                }
            }, []);

            // Enhanced Comparison Component
            const ComparisonModal = () => {
                if (!showComparison || !baseSystemResults || !results) return null;

                const maxLength = Math.max(baseSystemResults.schedule.length, results.schedule.length);
                
                return (
                    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 print-hidden" onClick={() => setShowComparison(false)}>
                        <div className="bg-white rounded-2xl shadow-2xl max-w-7xl w-full max-h-[90vh] overflow-y-auto animate-fade-in" onClick={(e) => e.stopPropagation()}>
                            <div className="bg-gradient-to-r from-blue-600 to-cyan-600 px-8 py-6 text-white sticky top-0 rounded-t-2xl z-10">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h2 className="text-3xl font-bold">üìä ÿ™ÿ≠ŸÑŸäŸÑ ŸÖŸÇÿßÿ±ŸÜ ŸÖÿ™ŸÇÿØŸÖ</h2>
                                        <p className="text-sm text-blue-100 mt-1">ŸÖŸÇÿßÿ±ŸÜÿ© ÿ¥ÿßŸÖŸÑÿ© ÿ®ŸäŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ŸàÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®</p>
                                    </div>
                                    <button onClick={() => setShowComparison(false)} className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                                </div>
                                
                                <div className="flex gap-2 mt-4">
                                    <button
                                        onClick={() => setComparisonView('summary')}
                                        className={`px-4 py-2 rounded-lg transition-all ${comparisonView === 'summary' ? 'bg-white text-blue-600' : 'bg-white/20'}`}
                                    >
                                        üìà ŸÖŸÑÿÆÿµ
                                    </button>
                                    <button
                                        onClick={() => setComparisonView('detailed')}
                                        className={`px-4 py-2 rounded-lg transition-all ${comparisonView === 'detailed' ? 'bg-white text-blue-600' : 'bg-white/20'}`}
                                    >
                                        üîç ÿ™ÿ≠ŸÑŸäŸÑ ÿ™ŸÅÿµŸäŸÑŸä
                                    </button>
                                    <button
                                        onClick={() => setComparisonView('schedule')}
                                        className={`px-4 py-2 rounded-lg transition-all ${comparisonView === 'schedule' ? 'bg-white text-blue-600' : 'bg-white/20'}`}
                                    >
                                        üìã ŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑÿ¨ÿØÿßŸàŸÑ
                                    </button>
                                </div>
                            </div>
                            
                            <div className="p-8">
                                {comparisonView === 'summary' && (
                                    <div className="space-y-6">
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                            <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200">
                                                <h3 className="text-2xl font-bold mb-4 text-blue-700 flex items-center gap-2">
                                                    <span>üìò</span> ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
                                                </h3>
                                                <div className="space-y-3">
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ÿßŸÑŸÖŸÇÿØŸÖ</p>
                                                        <p className="text-xl font-bold">{formatCurrency(baseSystemResults.downPayment)}</p>
                                                    </div>
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ÿπÿØÿØ ÿßŸÑÿØŸÅÿπÿßÿ™</p>
                                                        <p className="text-xl font-bold">{baseSystemResults.schedule.length - 1}</p>
                                                    </div>
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿØŸÅÿπÿ©</p>
                                                        <p className="text-xl font-bold">{formatCurrency(baseSystemResults.summary.averagePayment)}</p>
                                                    </div>
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿØŸÅŸàÿπ</p>
                                                        <p className="text-2xl font-bold text-blue-600">{formatCurrency(baseSystemResults.summary.totalPaid)}</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border-2 border-green-200">
                                                <h3 className="text-2xl font-bold mb-4 text-green-700 flex items-center gap-2">
                                                    <span>üìó</span> ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®
                                                </h3>
                                                <div className="space-y-3">
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ÿßŸÑŸÖŸÇÿØŸÖ</p>
                                                        <p className="text-xl font-bold">{formatCurrency(results.downPayment)}</p>
                                                    </div>
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ÿπÿØÿØ ÿßŸÑÿØŸÅÿπÿßÿ™</p>
                                                        <p className="text-xl font-bold">{results.schedule.length - 1}</p>
                                                    </div>
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿØŸÅÿπÿ©</p>
                                                        <p className="text-xl font-bold">{formatCurrency(results.summary.averagePayment)}</p>
                                                    </div>
                                                    <div className="bg-white rounded-lg p-4">
                                                        <p className="text-sm text-gray-600">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿØŸÅŸàÿπ</p>
                                                        <p className="text-2xl font-bold text-green-600">{formatCurrency(results.summary.totalPaid)}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-gradient-to-r from-yellow-50 to-amber-50 rounded-xl p-6 border-2 border-yellow-200">
                                            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
                                                <span>üìä</span> ÿßŸÑŸÅÿ±ŸàŸÇÿßÿ™ ŸàÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ
                                            </h3>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div className="bg-white rounded-lg p-4">
                                                    <p className="text-sm text-gray-600 mb-1">ŸÅÿ±ŸÇ ÿßŸÑŸÖŸÇÿØŸÖ</p>
                                                    <p className={`text-xl font-bold ${results.downPayment > baseSystemResults.downPayment ? 'text-green-600' : 'text-red-600'}`}>
                                                        {formatCurrency(Math.abs(results.downPayment - baseSystemResults.downPayment))}
                                                    </p>
                                                    <p className="text-xs text-gray-500 mt-1">
                                                        {results.downPayment > baseSystemResults.downPayment ? '‚Üë ÿ£ÿπŸÑŸâ' : '‚Üì ÿ£ŸÇŸÑ'}
                                                    </p>
                                                </div>
                                                <div className="bg-white rounded-lg p-4">
                                                    <p className="text-sm text-gray-600 mb-1">ŸÅÿ±ŸÇ ÿπÿØÿØ ÿßŸÑÿØŸÅÿπÿßÿ™</p>
                                                    <p className={`text-xl font-bold ${(results.schedule.length - 1) < (baseSystemResults.schedule.length - 1) ? 'text-green-600' : 'text-red-600'}`}>
                                                        {Math.abs((results.schedule.length - 1) - (baseSystemResults.schedule.length - 1))}
                                                    </p>
                                                    <p className="text-xs text-gray-500 mt-1">
                                                        {(results.schedule.length - 1) < (baseSystemResults.schedule.length - 1) ? 'ÿ£ŸÇŸÑ ÿØŸÅÿπÿßÿ™' : 'ÿ£ŸÉÿ´ÿ± ÿØŸÅÿπÿßÿ™'}
                                                    </p>
                                                </div>
                                                <div className="bg-white rounded-lg p-4">
                                                    <p className="text-sm text-gray-600 mb-1">ŸÅÿ±ŸÇ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</p>
                                                    <p className={`text-xl font-bold ${results.summary.totalPaid < baseSystemResults.summary.totalPaid ? 'text-green-600' : 'text-red-600'}`}>
                                                        {formatCurrency(Math.abs(results.summary.totalPaid - baseSystemResults.summary.totalPaid))}
                                                    </p>
                                                    <p className="text-xs text-gray-500 mt-1">
                                                        {results.summary.totalPaid < baseSystemResults.summary.totalPaid ? '‚Üì ÿ™ŸàŸÅŸäÿ±' : '‚Üë ÿ≤ŸäÿßÿØÿ©'}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {comparisonView === 'detailed' && (
                                    <div className="space-y-6">
                                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border-2 border-purple-200">
                                            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
                                                <span>üí∞</span> ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä
                                            </h3>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-sm comparison-table">
                                                    <thead className="bg-purple-100">
                                                        <tr>
                                                            <th className="px-4 py-3 text-right font-bold">ÿßŸÑÿ®ŸäÿßŸÜ</th>
                                                            <th className="px-4 py-3 text-center font-bold">ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä</th>
                                                            <th className="px-4 py-3 text-center font-bold">ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®</th>
                                                            <th className="px-4 py-3 text-center font-bold">ÿßŸÑŸÅÿ±ŸÇ</th>
                                                            <th className="px-4 py-3 text-center font-bold">ÿßŸÑŸÜÿ≥ÿ®ÿ© %</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td className="font-bold">ŸÇŸäŸÖÿ© ÿßŸÑŸàÿ≠ÿØÿ©</td>
                                                            <td className="text-center">{formatCurrency(unitValue)}</td>
                                                            <td className="text-center">{formatCurrency(unitValue)}</td>
                                                            <td className="text-center">-</td>
                                                            <td className="text-center">-</td>
                                                        </tr>
                                                        <tr>
                                                            <td className="font-bold">ÿßŸÑŸÖŸÇÿØŸÖ</td>
                                                            <td className="text-center">{formatCurrency(baseSystemResults.downPayment)}</td>
                                                            <td className="text-center">{formatCurrency(results.downPayment)}</td>
                                                            <td className={`text-center ${results.downPayment > baseSystemResults.downPayment ? 'comparison-highlight-negative' : 'comparison-highlight-positive'}`}>
                                                                {formatCurrency(results.downPayment - baseSystemResults.downPayment)}
                                                            </td>
                                                            <td className="text-center">
                                                                {((results.downPayment - baseSystemResults.downPayment) / baseSystemResults.downPayment * 100).toFixed(2)}%
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td className="font-bold">ÿπÿØÿØ ÿßŸÑÿØŸÅÿπÿßÿ™</td>
                                                            <td className="text-center">{baseSystemResults.schedule.length - 1}</td>
                                                            <td className="text-center">{results.schedule.length - 1}</td>
                                                            <td className={`text-center ${(results.schedule.length - 1) > (baseSystemResults.schedule.length - 1) ? 'comparison-highlight-negative' : 'comparison-highlight-positive'}`}>
                                                                {(results.schedule.length - 1) - (baseSystemResults.schedule.length - 1)}
                                                            </td>
                                                            <td className="text-center">
                                                                {(((results.schedule.length - 1) - (baseSystemResults.schedule.length - 1)) / (baseSystemResults.schedule.length - 1) * 100).toFixed(2)}%
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td className="font-bold">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿØŸÅÿπÿ©</td>
                                                            <td className="text-center">{formatCurrency(baseSystemResults.summary.averagePayment)}</td>
                                                            <td className="text-center">{formatCurrency(results.summary.averagePayment)}</td>
                                                            <td className={`text-center ${results.summary.averagePayment > baseSystemResults.summary.averagePayment ? 'comparison-highlight-negative' : 'comparison-highlight-positive'}`}>
                                                                {formatCurrency(results.summary.averagePayment - baseSystemResults.summary.averagePayment)}
                                                            </td>
                                                            <td className="text-center">
                                                                {((results.summary.averagePayment - baseSystemResults.summary.averagePayment) / baseSystemResults.summary.averagePayment * 100).toFixed(2)}%
                                                            </td>
                                                        </tr>
                                                        <tr className="bg-yellow-50">
                                                            <td className="font-bold">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿØŸÅŸàÿπ</td>
                                                            <td className="text-center font-bold">{formatCurrency(baseSystemResults.summary.totalPaid)}</td>
                                                            <td className="text-center font-bold">{formatCurrency(results.summary.totalPaid)}</td>
                                                            <td className={`text-center ${results.summary.totalPaid > baseSystemResults.summary.totalPaid ? 'comparison-highlight-negative' : 'comparison-highlight-positive'}`}>
                                                                {formatCurrency(results.summary.totalPaid - baseSystemResults.summary.totalPaid)}
                                                            </td>
                                                            <td className="text-center font-bold">
                                                                {((results.summary.totalPaid - baseSystemResults.summary.totalPaid) / baseSystemResults.summary.totalPaid * 100).toFixed(2)}%
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        {isAdmin && (
                                            <div className="bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl p-6 border-2 border-cyan-200">
                                                <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
                                                    <span>üìâ</span> ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ÿØŸÅŸÇÿßÿ™ ÿßŸÑŸÜŸÇÿØŸäÿ© (ŸÑŸÑŸÖÿØŸäÿ±)
                                                </h3>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className="bg-white rounded-lg p-4">
                                                        <h4 className="font-bold text-lg mb-3 text-blue-600">ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä</h4>
                                                        <div className="space-y-2 text-sm">
                                                            <div className="flex justify-between">
                                                                <span>ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿßŸÑÿµÿßŸÅŸäÿ©:</span>
                                                                <span className="font-bold">{formatCurrency(baseSystemResults.verification.totalPV)}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿÆÿµŸàŸÖÿßÿ™:</span>
                                                                <span className="font-bold">{formatCurrency(baseSystemResults.summary.totalDiscount)}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>ÿßŸÑŸÅÿßÿ¶ÿØÿ© ÿßŸÑŸÅÿπŸÑŸäÿ©:</span>
                                                                <span className="font-bold">{baseSystemResults.summary.effectiveInterestRate.toFixed(2)}%</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="bg-white rounded-lg p-4">
                                                        <h4 className="font-bold text-lg mb-3 text-green-600">ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®</h4>
                                                        <div className="space-y-2 text-sm">
                                                            <div className="flex justify-between">
                                                                <span>ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿßŸÑÿµÿßŸÅŸäÿ©:</span>
                                                                <span className="font-bold">{formatCurrency(results.verification.totalPV)}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿÆÿµŸàŸÖÿßÿ™:</span>
                                                                <span className="font-bold">{formatCurrency(results.summary.totalDiscount)}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>ÿßŸÑŸÅÿßÿ¶ÿØÿ© ÿßŸÑŸÅÿπŸÑŸäÿ©:</span>
                                                                <span className="font-bold">{results.summary.effectiveInterestRate.toFixed(2)}%</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {comparisonView === 'schedule' && (
                                    <div className="space-y-6">
                                        <div className="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-6 border-2 border-indigo-200">
                                            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
                                                <span>üìÖ</span> ŸÖŸÇÿßÿ±ŸÜÿ© ÿ¨ÿØÿßŸàŸÑ ÿßŸÑÿØŸÅÿπÿßÿ™
                                            </h3>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-sm comparison-table">
                                                    <thead className="bg-indigo-100">
                                                        <tr>
                                                            <th className="px-4 py-3 text-center font-bold">ŸÖ</th>
                                                            <th className="px-4 py-3 text-right font-bold">ÿßŸÑŸÜŸàÿπ (ÿ£ÿ≥ÿßÿ≥Ÿä)</th>
                                                            <th className="px-4 py-3 text-center font-bold">ÿßŸÑŸÖÿ®ŸÑÿ∫ (ÿ£ÿ≥ÿßÿ≥Ÿä)</th>
                                                            <th className="px-4 py-3 text-right font-bold">ÿßŸÑŸÜŸàÿπ (ŸÖÿ∑ŸÑŸàÿ®)</th>
                                                            <th className="px-4 py-3 text-center font-bold">ÿßŸÑŸÖÿ®ŸÑÿ∫ (ŸÖÿ∑ŸÑŸàÿ®)</th>
                                                            <th className="px-4 py-3 text-center font-bold">ÿßŸÑŸÅÿ±ŸÇ</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {Array.from({length: maxLength}).map((_, index) => {
                                                            const basePayment = baseSystemResults.schedule[index];
                                                            const newPayment = results.schedule[index];
                                                            const diff = (basePayment && newPayment) ? newPayment.amount - basePayment.amount : 0;
                                                            
                                                            return (
                                                                <tr key={index} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                                    <td className="text-center font-bold">{index + 1}</td>
                                                                    <td className="text-right">{basePayment ? basePayment.type : '-'}</td>
                                                                    <td className="text-center">{basePayment ? formatCurrency(basePayment.amount) : '-'}</td>
                                                                    <td className="text-right">{newPayment ? newPayment.type : '-'}</td>
                                                                    <td className="text-center">{newPayment ? formatCurrency(newPayment.amount) : '-'}</td>
                                                                    <td className={`text-center ${diff > 0 ? 'text-red-600' : diff < 0 ? 'text-green-600' : ''}`}>
                                                                        {(basePayment && newPayment) ? formatCurrency(Math.abs(diff)) : '-'}
                                                                        {diff > 0 && ' ‚Üë'}
                                                                        {diff < 0 && ' ‚Üì'}
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })}
                                                        <tr className="bg-yellow-100 font-bold">
                                                            <td colSpan="2" className="text-right">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</td>
                                                            <td className="text-center">{formatCurrency(baseSystemResults.summary.totalPaid)}</td>
                                                            <td className="text-right">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</td>
                                                            <td className="text-center">{formatCurrency(results.summary.totalPaid)}</td>
                                                            <td className={`text-center ${results.summary.totalPaid > baseSystemResults.summary.totalPaid ? 'text-red-600' : 'text-green-600'}`}>
                                                                {formatCurrency(Math.abs(results.summary.totalPaid - baseSystemResults.summary.totalPaid))}
                                                                {results.summary.totalPaid > baseSystemResults.summary.totalPaid ? ' ‚Üë' : ' ‚Üì'}
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 md:p-8" dir="rtl">
                    <div className="max-w-7xl mx-auto space-y-6">
                        
                        {/* Header */}
                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-2xl p-8 text-white relative overflow-hidden print-hidden">
                            <div className="absolute top-0 left-0 w-64 h-64 bg-white/10 rounded-full -translate-x-32 -translate-y-32"></div>
                            <div className="absolute bottom-0 right-0 w-96 h-96 bg-white/10 rounded-full translate-x-48 translate-y-48"></div>
                            
                            <div className="relative z-10">
                                <div className="flex items-center justify-between mb-4">
                                    <div>
                                        <h1 className="text-4xl font-bold mb-2">üè¢ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÇÿ≥Ÿäÿ∑ ÿßŸÑŸÖÿ±ŸÜ</h1>
                                        <p className="text-indigo-100 text-lg">BETA SMART FINANCE | ÿ¥ÿ±ŸÉÿ© ÿ®Ÿäÿ™ÿß ŸÑŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿπŸÇÿßÿ±Ÿä</p>
                                    </div>
                                    <button
                                        onClick={() => isAdmin ? setIsAdmin(false) : setShowAdminPanel(true)}
                                        className="bg-white/20 hover:bg-white/30 px-6 py-3 rounded-xl backdrop-blur-lg transition-all"
                                    >
                                        {isAdmin ? 'üîì Ÿàÿ∂ÿπ ÿßŸÑŸÖÿØŸäÿ±' : 'üîí ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Admin Login */}
                        {showAdminPanel && !isAdmin && (
                            <div className="bg-white rounded-xl shadow-lg p-6 border-2 border-indigo-200 animate-fade-in print-hidden">
                                <h3 className="text-xl font-bold text-gray-800 mb-4">üîê ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿØŸäÿ±</h3>
                                <div className="flex gap-4">
                                    <input
                                        type="password"
                                        value={adminPassword}
                                        onChange={(e) => setAdminPassword(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAdminLogin()}
                                        placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"
                                        className="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                                    />
                                    <button onClick={handleAdminLogin} className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition-colors">ÿØÿÆŸàŸÑ</button>
                                    <button onClick={() => setShowAdminPanel(false)} className="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg transition-colors">ÿ•ŸÑÿ∫ÿßÿ°</button>
                                </div>
                            </div>
                        )}

                        {/* Projects Selection */}
                        <div className="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 print-hidden">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-2xl font-bold text-gray-800">üè¢ ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</h2>
                                {isAdmin && (
                                    <div className="flex gap-2">
                                        <button onClick={addProject} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                                            ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ¥ÿ±Ÿàÿπ
                                        </button>
                                        <button onClick={() => setShowProjectsManager(!showProjectsManager)} className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors">
                                            ‚öôÔ∏è ÿ•ÿØÿßÿ±ÿ©
                                        </button>
                                    </div>
                                )}
                            </div>

                            {isAdmin && showProjectsManager && (
                                <div className="mb-6 p-4 bg-gray-50 rounded-lg border-2 border-gray-200 animate-fade-in">
                                    <h3 className="font-bold text-lg mb-4">‚öôÔ∏è ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</h3>
                                    <div className="space-y-4">
                                        {projects.map(project => (
                                            <div key={project.id} className="bg-white p-4 rounded-lg border border-gray-300">
                                                {editingProject === project.id ? (
                                                    <div className="space-y-3">
                                                        <input
                                                            type="text"
                                                            value={project.name}
                                                            onChange={(e) => updateProject(project.id, 'name', e.target.value)}
                                                            className="w-full px-3 py-2 border border-gray-300 rounded"
                                                            placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ"
                                                        />
                                                        <input
                                                            type="text"
                                                            value={project.description}
                                                            onChange={(e) => updateProject(project.id, 'description', e.target.value)}
                                                            className="w-full px-3 py-2 border border-gray-300 rounded"
                                                            placeholder="ŸàÿµŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ"
                                                        />
                                                        <div className="grid grid-cols-2 gap-3">
                                                            <div>
                                                                <label className="text-sm font-bold">ŸÜÿ≥ÿ®ÿ© ÿÆÿµŸÖ ÿßŸÑŸÉÿßÿ¥ (%)</label>
                                                                <input
                                                                    type="number"
                                                                    step="0.01"
                                                                    value={project.cashDiscountRate}
                                                                    onChange={(e) => updateProject(project.id, 'cashDiscountRate', parseFloat(e.target.value))}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded"
                                                                />
                                                            </div>
                                                            <div>
                                                                <label className="text-sm font-bold flex items-center gap-2">
                                                                    ŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ (%)
                                                                    {project.discountRateMode === 'auto' && (
                                                                        <span className="text-xs bg-green-100 text-green-600 px-2 py-1 rounded">ŸÖÿ≠ÿ≥Ÿàÿ®</span>
                                                                    )}
                                                                </label>
                                                                <input
                                                                    type="number"
                                                                    step="0.001"
                                                                    value={project.discountRate}
                                                                    onChange={(e) => {
                                                                        const newValue = e.target.value;
                                                                        if (newValue === '' || newValue === null) {
                                                                            updateProject(project.id, 'discountRate', 0);
                                                                        } else {
                                                                            const parsedValue = parseFloat(newValue);
                                                                            if (!isNaN(parsedValue)) {
                                                                                updateProject(project.id, 'discountRate', parsedValue);
                                                                                updateProject(project.id, 'discountRateMode', 'manual');
                                                                            }
                                                                        }
                                                                    }}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded"
                                                                    placeholder="ÿ£ÿØÿÆŸÑ ŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ"
                                                                />
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => setEditingProject(null)} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                                                                ‚úì ÿ≠ŸÅÿ∏
                                                            </button>
                                                            <button onClick={() => openBaseSystemModal(project.id)} className="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded">
                                                                üßÆ ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
                                                            </button>
                                                            <button onClick={() => deleteProject(project.id)} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
                                                                üóëÔ∏è ÿ≠ÿ∞ŸÅ
                                                            </button>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="flex items-center justify-between">
                                                        <div className="flex-1">
                                                            <h4 className="font-bold text-lg">{project.name}</h4>
                                                            <p className="text-sm text-gray-600">{project.description}</p>
                                                            <p className="text-xs text-gray-500 mt-1">
                                                                ÿÆÿµŸÖ ŸÉÿßÿ¥: {project.cashDiscountRate}% | ŸÖÿπÿØŸÑ ÿÆÿµŸÖ: {project.discountRate.toFixed(3)}%
                                                                {project.discountRateMode === 'auto' && <span className="text-green-600"> (ŸÖÿ≠ÿ≥Ÿàÿ®)</span>}
                                                            </p>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => openBaseSystemModal(project.id)} className="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded">
                                                                üßÆ
                                                            </button>
                                                            <button onClick={() => setEditingProject(project.id)} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                                                                ‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ
                                                            </button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {projects.map(project => (
                                    <button
                                        key={project.id}
                                        onClick={() => setSelectedProjectId(project.id)}
                                        className={`p-4 rounded-xl border-2 transition-all text-right ${
                                            selectedProjectId === project.id 
                                                ? 'border-indigo-500 bg-indigo-50 shadow-lg scale-105' 
                                                : 'border-gray-200 hover:border-gray-300'
                                        }`}
                                    >
                                        <h3 className="font-bold text-lg text-gray-800 mb-1">{project.name}</h3>
                                        <p className="text-sm text-gray-600 mb-2">{project.description}</p>
                                        <div className="text-xs text-gray-500 space-y-1">
                                            <div className="bg-gray-100 px-2 py-1 rounded">ÿÆÿµŸÖ ŸÉÿßÿ¥: {project.cashDiscountRate}%</div>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Base System Modal */}
                        {showBaseSystemModal && currentProjectForBaseSystem && (
                            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 print-hidden" onClick={() => setShowBaseSystemModal(false)}>
                                <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-slide-in" onClick={(e) => e.stopPropagation()}>
                                    <div className="bg-gradient-to-r from-cyan-600 to-blue-600 px-8 py-6 text-white sticky top-0 rounded-t-2xl">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h2 className="text-2xl font-bold">üßÆ ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä</h2>
                                                <p className="text-sm text-cyan-100 mt-1">{currentProjectForBaseSystem.name}</p>
                                            </div>
                                            <button onClick={() => setShowBaseSystemModal(false)} className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                                        </div>
                                    </div>
                                    
                                    <div className="p-8 space-y-6">
                                        <div className="space-y-4">
                                            <div className="bg-gradient-to-r from-cyan-50 to-blue-50 p-4 rounded-lg border-2 border-cyan-200 mb-4">
                                                <h3 className="font-bold text-lg text-gray-800 mb-2">üí° ŸÖÿπŸÑŸàŸÖÿßÿ™ ŸáÿßŸÖÿ©</h3>
                                                <p className="text-sm text-gray-700">ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿßÿ™ ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ© ŸÖÿπ ÿ™ÿ≠ÿØŸäÿØ ÿ™Ÿàÿßÿ±ŸäÿÆŸáÿß ÿ®ÿØŸÇÿ©</p>
                                            </div>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÿßŸÑŸÖŸÇÿØŸÖ</label>
                                                    <div className="flex gap-2">
                                                        <input
                                                            type="number"
                                                            value={tempBaseSystem.downPaymentValue}
                                                            onChange={(e) => setTempBaseSystem({...tempBaseSystem, downPaymentValue: parseFloat(e.target.value) || 0})}
                                                            className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500"
                                                            placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                                        />
                                                        <select
                                                            value={tempBaseSystem.downPaymentIsPercentage ? 'percentage' : 'value'}
                                                            onChange={(e) => setTempBaseSystem({...tempBaseSystem, downPaymentIsPercentage: e.target.value === 'percentage'})}
                                                            className="px-4 py-3 border-2 border-gray-300 rounded-lg bg-white focus:border-cyan-500"
                                                        >
                                                            <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                                            <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÿ™ÿßÿ±ŸäÿÆ ÿ®ÿØÿßŸäÿ© ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑</label>
                                                    <input
                                                        type="date"
                                                        value={tempBaseSystem.startDate || ''}
                                                        onChange={(e) => setTempBaseSystem({...tempBaseSystem, startDate: e.target.value})}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500"
                                                    />
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÿπÿØÿØ ÿ≥ŸÜŸàÿßÿ™ ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑ ÿßŸÑÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ©</label>
                                                    <input
                                                        type="number"
                                                        value={tempBaseSystem.quarterlyYears}
                                                        onChange={(e) => setTempBaseSystem({...tempBaseSystem, quarterlyYears: parseFloat(e.target.value) || 0})}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                            </div>

                                            {/* Annual Payments */}
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">ÿØŸÅÿπÿßÿ™ ÿ≥ŸÜŸàŸäÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                                <div className="space-y-2">
                                                    {tempBaseSystem.annualPayments && tempBaseSystem.annualPayments.map((payment, index) => (
                                                        <div key={index} className="flex gap-2 items-center">
                                                            <input
                                                                type="number"
                                                                value={payment.value}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.annualPayments];
                                                                    updated[index].value = parseFloat(e.target.value) || 0;
                                                                    setTempBaseSystem({...tempBaseSystem, annualPayments: updated});
                                                                }}
                                                                className="flex-1 px-3 py-2 border rounded focus:border-cyan-500"
                                                                placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                                            />
                                                            <select
                                                                value={payment.isPercentage ? 'percentage' : 'value'}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.annualPayments];
                                                                    updated[index].isPercentage = e.target.value === 'percentage';
                                                                    setTempBaseSystem({...tempBaseSystem, annualPayments: updated});
                                                                }}
                                                                className="px-3 py-2 border rounded bg-white focus:border-cyan-500"
                                                            >
                                                                <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                                                <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                                            </select>
                                                            <input
                                                                type="date"
                                                                value={payment.date || ''}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.annualPayments];
                                                                    updated[index].date = e.target.value;
                                                                    setTempBaseSystem({...tempBaseSystem, annualPayments: updated});
                                                                }}
                                                                className="px-3 py-2 border rounded focus:border-cyan-500"
                                                                placeholder="ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"
                                                            />
                                                            <button
                                                                onClick={() => {
                                                                    const updated = tempBaseSystem.annualPayments.filter((_, i) => i !== index);
                                                                    setTempBaseSystem({...tempBaseSystem, annualPayments: updated});
                                                                }}
                                                                className="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600"
                                                            >
                                                                ‚úï
                                                            </button>
                                                        </div>
                                                    ))}
                                                    <button
                                                        onClick={() => {
                                                            const updated = [...(tempBaseSystem.annualPayments || []), { value: 10, isPercentage: true, type: 'ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ©', date: '' }];
                                                            setTempBaseSystem({...tempBaseSystem, annualPayments: updated});
                                                        }}
                                                        className="w-full bg-green-500 text-white px-3 py-2 rounded hover:bg-green-600"
                                                    >
                                                        ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ©
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Semiannual Payments */}
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">ÿØŸÅÿπÿßÿ™ ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                                <div className="space-y-2">
                                                    {tempBaseSystem.semiannualPayments && tempBaseSystem.semiannualPayments.map((payment, index) => (
                                                        <div key={index} className="flex gap-2 items-center">
                                                            <input
                                                                type="number"
                                                                value={payment.value}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.semiannualPayments];
                                                                    updated[index].value = parseFloat(e.target.value) || 0;
                                                                    setTempBaseSystem({...tempBaseSystem, semiannualPayments: updated});
                                                                }}
                                                                className="flex-1 px-3 py-2 border rounded focus:border-cyan-500"
                                                                placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                                            />
                                                            <select
                                                                value={payment.isPercentage ? 'percentage' : 'value'}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.semiannualPayments];
                                                                    updated[index].isPercentage = e.target.value === 'percentage';
                                                                    setTempBaseSystem({...tempBaseSystem, semiannualPayments: updated});
                                                                }}
                                                                className="px-3 py-2 border rounded bg-white focus:border-cyan-500"
                                                            >
                                                                <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                                                <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                                            </select>
                                                            <input
                                                                type="date"
                                                                value={payment.date || ''}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.semiannualPayments];
                                                                    updated[index].date = e.target.value;
                                                                    setTempBaseSystem({...tempBaseSystem, semiannualPayments: updated});
                                                                }}
                                                                className="px-3 py-2 border rounded focus:border-cyan-500"
                                                                placeholder="ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"
                                                            />
                                                            <button
                                                                onClick={() => {
                                                                    const updated = tempBaseSystem.semiannualPayments.filter((_, i) => i !== index);
                                                                    setTempBaseSystem({...tempBaseSystem, semiannualPayments: updated});
                                                                }}
                                                                className="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600"
                                                            >
                                                                ‚úï
                                                            </button>
                                                        </div>
                                                    ))}
                                                    <button
                                                        onClick={() => {
                                                            const updated = [...(tempBaseSystem.semiannualPayments || []), { value: 5, isPercentage: true, type: 'ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ©', date: '' }];
                                                            setTempBaseSystem({...tempBaseSystem, semiannualPayments: updated});
                                                        }}
                                                        className="w-full bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600"
                                                    >
                                                        ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ©
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Quarterly Payments - NEW */}
                                            <div className="bg-gradient-to-r from-cyan-50 to-blue-50 p-4 rounded-lg border-2 border-cyan-200">
                                                <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                    <span>üìÖ</span>
                                                    <span>ÿØŸÅÿπÿßÿ™ ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</span>
                                                    <span className="text-xs bg-cyan-600 text-white px-2 py-1 rounded">ÿ¨ÿØŸäÿØ</span>
                                                </label>
                                                <div className="space-y-2">
                                                    {tempBaseSystem.quarterlyPayments && tempBaseSystem.quarterlyPayments.map((payment, index) => (
                                                        <div key={index} className="flex gap-2 items-center bg-white p-3 rounded-lg">
                                                            <input
                                                                type="number"
                                                                value={payment.value}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.quarterlyPayments];
                                                                    updated[index].value = parseFloat(e.target.value) || 0;
                                                                    setTempBaseSystem({...tempBaseSystem, quarterlyPayments: updated});
                                                                }}
                                                                className="flex-1 px-3 py-2 border-2 border-gray-300 rounded focus:border-cyan-500"
                                                                placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                                            />
                                                            <select
                                                                value={payment.isPercentage ? 'percentage' : 'value'}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.quarterlyPayments];
                                                                    updated[index].isPercentage = e.target.value === 'percentage';
                                                                    setTempBaseSystem({...tempBaseSystem, quarterlyPayments: updated});
                                                                }}
                                                                className="px-3 py-2 border-2 border-gray-300 rounded bg-white focus:border-cyan-500"
                                                            >
                                                                <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                                                <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                                            </select>
                                                            <input
                                                                type="date"
                                                                value={payment.date || ''}
                                                                onChange={(e) => {
                                                                    const updated = [...tempBaseSystem.quarterlyPayments];
                                                                    updated[index].date = e.target.value;
                                                                    setTempBaseSystem({...tempBaseSystem, quarterlyPayments: updated});
                                                                }}
                                                                className="px-3 py-2 border-2 border-gray-300 rounded focus:border-cyan-500"
                                                                placeholder="ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"
                                                            />
                                                            <button
                                                                onClick={() => {
                                                                    const updated = tempBaseSystem.quarterlyPayments.filter((_, i) => i !== index);
                                                                    setTempBaseSystem({...tempBaseSystem, quarterlyPayments: updated});
                                                                }}
                                                                className="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600 transition-all"
                                                            >
                                                                ‚úï
                                                            </button>
                                                        </div>
                                                    ))}
                                                    <button
                                                        onClick={() => {
                                                            const updated = [...(tempBaseSystem.quarterlyPayments || []), { 
                                                                value: 5, 
                                                                isPercentage: true, 
                                                                type: 'ÿØŸÅÿπÿ© ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ©',
                                                                date: ''
                                                            }];
                                                            setTempBaseSystem({...tempBaseSystem, quarterlyPayments: updated});
                                                        }}
                                                        className="w-full bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-4 py-3 rounded-lg hover:from-cyan-600 hover:to-blue-600 font-bold transition-all"
                                                    >
                                                        ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ© ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ©
                                                    </button>
                                                    <p className="text-xs text-gray-600 mt-2">üí° ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ≠ÿØŸäÿØ ŸÇŸäŸÖÿ© Ÿàÿ™ÿßÿ±ŸäÿÆ ŸÉŸÑ ÿØŸÅÿπÿ© ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ© ÿ®ÿ¥ŸÉŸÑ ŸÖŸÜŸÅÿµŸÑ</p>
                                                </div>
                                            </div>

                                            <div className="flex gap-3">
                                                <button
                                                    onClick={() => {
                                                        const updatedProjects = projects.map(p => {
                                                            if (p.id === currentProjectForBaseSystem.id) {
                                                                return {
                                                                    ...p,
                                                                    baseSystem: tempBaseSystem
                                                                };
                                                            }
                                                            return p;
                                                        });
                                                        setProjects(updatedProjects);
                                                        setShowBaseSystemModal(false);
                                                        alert('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä!');
                                                    }}
                                                    className="flex-1 bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl text-lg font-bold transition-all shadow-lg"
                                                >
                                                    ‚úì ÿ≠ŸÅÿ∏ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
                                                </button>
                                                <button
                                                    onClick={calculateDiscountRateForProject}
                                                    className="flex-1 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white px-8 py-4 rounded-xl text-lg font-bold transition-all shadow-lg"
                                                >
                                                    üßÆ ÿ≠ŸÅÿ∏ + ÿ≠ÿ≥ÿßÿ® ŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ
                                                </button>
                                            </div>

                                            <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                                                <p className="text-sm text-gray-700">
                                                    <strong>üí° ŸÖŸÑÿ≠Ÿàÿ∏ÿ©:</strong> ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ≠ŸÅÿ∏ + ÿ≠ÿ≥ÿßÿ® ŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ"ÿå ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ≥ÿßÿ® ŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ÿßŸÑŸÖÿ≠ÿØÿØ.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Pattern Selection */}
                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl shadow-lg p-6 border-2 border-purple-200 print-hidden">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6">üí° ÿßÿÆÿ™ÿ± ŸÜŸÖÿ∑ ÿßŸÑÿ≥ÿØÿßÿØ</h2>
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                {patterns.map(pattern => (
                                    <button
                                        key={pattern.id}
                                        onClick={() => setSelectedPattern(pattern.id)}
                                        className={`p-5 rounded-xl border-2 transition-all text-right ${
                                            selectedPattern === pattern.id 
                                                ? 'border-purple-500 bg-purple-50 shadow-lg scale-105' 
                                                : 'border-gray-200 hover:border-gray-300 bg-white'
                                        }`}
                                    >
                                        <div className="text-4xl mb-3">{pattern.icon}</div>
                                        <h3 className="font-bold text-xl text-gray-800 mb-2">{pattern.name}</h3>
                                        <p className="text-sm text-gray-600">{pattern.description}</p>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Input Settings */}
                        <div className="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 print-hidden">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6">‚öôÔ∏è ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸàÿ≠ÿØÿ© ŸàÿßŸÑÿ≥ÿØÿßÿØ</h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">ŸÇŸäŸÖÿ© ÿßŸÑŸàÿ≠ÿØÿ© (ÿ¨)</label>
                                    <input type="number" value={unitValue} onChange={(e) => setUnitValue(parseFloat(e.target.value) || 0)}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÿ±ŸÇŸÖ ÿßŸÑŸàÿ≠ÿØÿ©</label>
                                    <input type="text" value={unitNumber} onChange={(e) => setUnitNumber(e.target.value)}
                                        placeholder="ŸÖÿ´ÿßŸÑ: A-101"
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÿßŸÑŸÖŸÇÿØŸÖ</label>
                                    <div className="flex gap-2">
                                        <input
                                            type="number"
                                            value={downPaymentValue}
                                            onChange={(e) => setDownPaymentValue(parseFloat(e.target.value) || 0)}
                                            className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                                            placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                        />
                                        <select
                                            value={downPaymentIsPercentage ? 'percentage' : 'value'}
                                            onChange={(e) => setDownPaymentIsPercentage(e.target.value === 'percentage')}
                                            className="px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none bg-white"
                                        >
                                            <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                            <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            {getSelectedProject()?.baseSystem && unitValue > 0 && selectedPattern !== 'custom' && (
                                <div className="mb-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                    <div className="flex items-center justify-between mb-2">
                                        <h3 className="font-bold text-lg text-gray-800">üìã ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ŸÑŸÑŸÖÿ¥ÿ±Ÿàÿπ</h3>
                                        <button
                                            onClick={() => {
                                                calculateResults();
                                                setShowComparison(true);
                                            }}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm"
                                        >
                                            üìä ŸÖŸÇÿßÿ±ŸÜÿ©
                                        </button>
                                    </div>
                                    <div className="text-sm text-gray-700 space-y-1">
                                        <p>‚Ä¢ ÿßŸÑŸÖŸÇÿØŸÖ: {getSelectedProject().baseSystem.downPaymentIsPercentage ? `${getSelectedProject().baseSystem.downPaymentValue}%` : formatCurrency(getSelectedProject().baseSystem.downPaymentValue)}</p>
                                        {getSelectedProject().baseSystem.annualPayments && getSelectedProject().baseSystem.annualPayments.map((p, i) => (
                                            <p key={i}>‚Ä¢ ÿØŸÅÿπÿ© ÿ≥ŸÜŸàŸäÿ© {i+1}: {p.isPercentage ? `${p.value}%` : formatCurrency(p.value)}</p>
                                        ))}
                                        {getSelectedProject().baseSystem.semiannualPayments && getSelectedProject().baseSystem.semiannualPayments.map((p, i) => (
                                            <p key={i}>‚Ä¢ ÿØŸÅÿπÿ© ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ© {i+1}: {p.isPercentage ? `${p.value}%` : formatCurrency(p.value)}</p>
                                        ))}
                                        <p>‚Ä¢ ÿ£ŸÇÿ≥ÿßÿ∑ ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ©: {getSelectedProject().baseSystem.quarterlyYears} ÿ≥ŸÜŸàÿßÿ™</p>
                                    </div>
                                </div>
                            )}

                            {(selectedPattern === 'equal' || selectedPattern === 'decreasing' || selectedPattern === 'graduated') && (
                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2">ŸÖÿØÿ© ÿßŸÑÿ™ŸÇÿ≥Ÿäÿ∑ (ÿ≥ŸÜŸàÿßÿ™)</label>
                                            <input type="number" value={numberOfYears} onChange={(e) => setNumberOfYears(parseFloat(e.target.value) || 0)}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2">ÿ™ÿ±ÿØÿØ ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑</label>
                                            <select value={frequency} onChange={(e) => setFrequency(parseInt(e.target.value))}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg">
                                                <option value="12">ÿ¥Ÿáÿ±Ÿä</option>
                                                <option value="4">ÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸä</option>
                                                <option value="2">ŸÜÿµŸÅ ÿ≥ŸÜŸàŸä</option>
                                                <option value="1">ÿ≥ŸÜŸàŸä</option>
                                            </select>
                                        </div>
                                    </div>

                                    {selectedPattern === 'decreasing' && (
                                        <div className="p-4 bg-emerald-50 rounded-lg border-2 border-emerald-200">
                                            <label className="block text-sm font-bold text-gray-700 mb-2">ŸÖÿπÿØŸÑ ÿßŸÑÿ™ŸÜÿßŸÇÿµ (% ŸÉŸÑ ŸÅÿ™ÿ±ÿ©)</label>
                                            <input type="number" value={decreaseRate} onChange={(e) => setDecreaseRate(parseFloat(e.target.value) || 0)}
                                                className="w-full px-4 py-3 border-2 border-emerald-300 rounded-lg" />
                                        </div>
                                    )}

                                    {selectedPattern === 'graduated' && (
                                        <div className="p-4 bg-purple-50 rounded-lg border-2 border-purple-200">
                                            <label className="block text-sm font-bold text-gray-700 mb-2">ŸÖÿπÿØŸÑ ÿßŸÑÿ≤ŸäÿßÿØÿ© (% ŸÉŸÑ ŸÅÿ™ÿ±ÿ©)</label>
                                            <input type="number" value={growthRate} onChange={(e) => setGrowthRate(parseFloat(e.target.value) || 0)}
                                                className="w-full px-4 py-3 border-2 border-purple-300 rounded-lg" />
                                        </div>
                                    )}

                                    {/* Annual Payments */}
                                    <div className="p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="font-bold text-lg flex items-center gap-2">
                                                <span>üìÖ</span> ÿØŸÅÿπÿßÿ™ ÿ≥ŸÜŸàŸäÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
                                            </h3>
                                            <button onClick={addAnnualPayment} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                                                ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ©
                                            </button>
                                        </div>

                                        {annualPayments.length > 0 && (
                                            <div className="space-y-3">
                                                {annualPayments.map((payment) => (
                                                    <div key={payment.id} className="bg-white p-3 rounded-lg border border-green-300">
                                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                                                            <input
                                                                type="text"
                                                                value={payment.type}
                                                                onChange={(e) => updateAnnualPayment(payment.id, 'type', e.target.value)}
                                                                placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿØŸÅÿπÿ©"
                                                                className="px-3 py-2 border rounded"
                                                            />
                                                            <div className="flex gap-2">
                                                                <input
                                                                    type="number"
                                                                    value={payment.value}
                                                                    onChange={(e) => updateAnnualPayment(payment.id, 'value', parseFloat(e.target.value))}
                                                                    placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                                                    className="flex-1 px-3 py-2 border rounded"
                                                                />
                                                                <select
                                                                    value={payment.isPercentage ? 'percentage' : 'value'}
                                                                    onChange={(e) => updateAnnualPayment(payment.id, 'isPercentage', e.target.value === 'percentage')}
                                                                    className="px-3 py-2 border rounded bg-white"
                                                                >
                                                                    <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                                                    <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                                                </select>
                                                            </div>
                                                            <input
                                                                type="date"
                                                                value={payment.date}
                                                                onChange={(e) => updateAnnualPayment(payment.id, 'date', e.target.value)}
                                                                className="px-3 py-2 border rounded"
                                                            />
                                                            <button onClick={() => deleteAnnualPayment(payment.id)} className="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded">
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Semiannual Payments */}
                                    <div className="p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="font-bold text-lg flex items-center gap-2">
                                                <span>üìÖ</span> ÿØŸÅÿπÿßÿ™ ŸÜÿµŸÅ ÿ≥ŸÜŸàŸäÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
                                            </h3>
                                            <button onClick={addSemiannualPayment} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                                ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ©
                                            </button>
                                        </div>

                                        {semiannualPayments.length > 0 && (
                                            <div className="space-y-3">
                                                {semiannualPayments.map((payment) => (
                                                    <div key={payment.id} className="bg-white p-3 rounded-lg border border-blue-300">
                                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                                                            <input
                                                                type="text"
                                                                value={payment.type}
                                                                onChange={(e) => updateSemiannualPayment(payment.id, 'type', e.target.value)}
                                                                placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿØŸÅÿπÿ©"
                                                                className="px-3 py-2 border rounded"
                                                            />
                                                            <div className="flex gap-2">
                                                                <input
                                                                    type="number"
                                                                    value={payment.value}
                                                                    onChange={(e) => updateSemiannualPayment(payment.id, 'value', parseFloat(e.target.value))}
                                                                    placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                                                    className="flex-1 px-3 py-2 border rounded"
                                                                />
                                                                <select
                                                                    value={payment.isPercentage ? 'percentage' : 'value'}
                                                                    onChange={(e) => updateSemiannualPayment(payment.id, 'isPercentage', e.target.value === 'percentage')}
                                                                    className="px-3 py-2 border rounded bg-white"
                                                                >
                                                                    <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                                                    <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                                                </select>
                                                            </div>
                                                            <input
                                                                type="date"
                                                                value={payment.date}
                                                                onChange={(e) => updateSemiannualPayment(payment.id, 'date', e.target.value)}
                                                                className="px-3 py-2 border rounded"
                                                            />
                                                            <button onClick={() => deleteSemiannualPayment(payment.id)} className="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded">
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">ÿ™ÿßÿ±ŸäÿÆ ÿ®ÿØÿ° ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑</label>
                                        <input
                                            type="date"
                                            value={quarterlyStartDate}
                                            onChange={(e) => setQuarterlyStartDate(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        />
                                    </div>
                                </div>
                            )}

                            {selectedPattern === 'custom' && (
                                <div className="space-y-6">
                                    <div className="p-4 bg-amber-50 rounded-lg border-2 border-amber-200">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="font-bold text-lg">ÿØŸÅÿπÿßÿ™ ŸÖÿÆÿµÿµÿ©</h3>
                                            <button onClick={addCustomPayment} className="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg text-sm">
                                                ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ©
                                            </button>
                                        </div>

                                        {customPayments.length > 0 && (
                                            <div className="space-y-3">
                                                {customPayments.map((payment) => (
                                                    <div key={payment.id} className="bg-white p-3 rounded-lg border border-amber-300">
                                                        <div className="grid grid-cols-1 md:grid-cols-6 gap-3">
                                                            <input
                                                                type="text"
                                                                value={payment.type}
                                                                onChange={(e) => updateCustomPayment(payment.id, 'type', e.target.value)}
                                                                placeholder="ÿßÿ≥ŸÖ"
                                                                className="px-3 py-2 border rounded"
                                                            />
                                                            <div className="flex gap-2">
                                                                <input
                                                                    type="number"
                                                                    value={payment.value}
                                                                    onChange={(e) => updateCustomPayment(payment.id, 'value', parseFloat(e.target.value))}
                                                                    placeholder="ÿßŸÑŸÇŸäŸÖÿ©"
                                                                    className="flex-1 px-3 py-2 border rounded"
                                                                />
                                                                <select
                                                                    value={payment.isPercentage ? 'percentage' : 'value'}
                                                                    onChange={(e) => updateCustomPayment(payment.id, 'isPercentage', e.target.value === 'percentage')}
                                                                    className="px-3 py-2 border rounded bg-white"
                                                                >
                                                                    <option value="percentage">ŸÜÿ≥ÿ®ÿ© %</option>
                                                                    <option value="value">ŸÇŸäŸÖÿ© ÿ¨</option>
                                                                </select>
                                                            </div>
                                                            <select
                                                                value={payment.frequency}
                                                                onChange={(e) => updateCustomPayment(payment.id, 'frequency', e.target.value)}
                                                                className="px-3 py-2 border rounded"
                                                            >
                                                                <option value="once">ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©</option>
                                                                <option value="annual">ÿ≥ŸÜŸàŸä</option>
                                                                <option value="semiannual">ŸÜÿµŸÅ ÿ≥ŸÜŸàŸä</option>
                                                            </select>
                                                            {payment.frequency !== 'once' && (
                                                                <input
                                                                    type="number"
                                                                    value={payment.numberOfPayments || 1}
                                                                    onChange={(e) => updateCustomPayment(payment.id, 'numberOfPayments', parseInt(e.target.value))}
                                                                    placeholder="ÿßŸÑÿπÿØÿØ"
                                                                    className="px-3 py-2 border rounded"
                                                                />
                                                            )}
                                                            <input
                                                                type="date"
                                                                value={payment.startDate}
                                                                onChange={(e) => updateCustomPayment(payment.id, 'startDate', e.target.value)}
                                                                className="px-3 py-2 border rounded"
                                                            />
                                                            <button onClick={() => deleteCustomPayment(payment.id)} className="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded">
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2">ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑ ÿßŸÑÿ±ÿ®ÿπ ÿ≥ŸÜŸàŸäÿ© (ÿ≥ŸÜŸàÿßÿ™)</label>
                                            <input
                                                type="number"
                                                value={quarterlyYears}
                                                onChange={(e) => setQuarterlyYears(parseFloat(e.target.value) || 0)}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2">ÿ™ÿßÿ±ŸäÿÆ ÿ®ÿØÿ° ÿßŸÑÿ£ŸÇÿ≥ÿßÿ∑</label>
                                            <input
                                                type="date"
                                                value={customQuarterlyStartDate}
                                                onChange={(e) => setCustomQuarterlyStartDate(e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                            />
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="flex justify-center mt-6">
                                <button onClick={calculateResults}
                                    className="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-12 py-4 rounded-xl text-lg font-bold transition-all shadow-lg hover:shadow-xl">
                                    üßÆ ÿßÿ≠ÿ≥ÿ® ÿÆÿ∑ÿ© ÿßŸÑÿ≥ÿØÿßÿØ
                                </button>
                            </div>
                        </div>

                        {/* Results Display */}
                        {results && (
                            <div className="space-y-6">
                                {/* Print Header */}
                                <div className="print-only">
                                    <div className="text-center border-b-4 border-indigo-600 pb-6 mb-6">
                                        <h1 className="text-3xl font-bold text-indigo-600 mb-2">ÿ¥ÿ±ŸÉÿ© ÿ®Ÿäÿ™ÿß ŸÑŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿπŸÇÿßÿ±Ÿä</h1>
                                        <p className="text-xl text-gray-700">BETA SMART FINANCE | ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÇÿ≥Ÿäÿ∑ ÿßŸÑŸÖÿ±ŸÜ</p>
                                        <p className="text-sm text-gray-600 mt-2">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: {new Date().toLocaleDateString('ar-EG')}</p>
                                    </div>
                                </div>

                                {/* Summary Card */}
                                <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl shadow-lg p-6 border-2 border-green-200 print-container">
                                    <div className="flex items-center justify-between mb-4 print-hidden">
                                        <h2 className="text-2xl font-bold text-gray-800">‚úÖ ÿÆÿ∑ÿ© ÿßŸÑÿ≥ÿØÿßÿØ - {results.patternName}</h2>
                                        <div className="flex gap-3">
                                            {baseSystemResults && (
                                                <button onClick={() => setShowComparison(true)} className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                                                    üìä ŸÖŸÇÿßÿ±ŸÜÿ© ŸÖÿ™ŸÇÿØŸÖÿ©
                                                </button>
                                            )}
                                            <button onClick={handlePrint} className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg flex items-center gap-2">
                                                üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ©
                                            </button>
                                        </div>
                                    </div>

                                    <div className="print-only mb-6">
                                        <div className="grid grid-cols-2 gap-4 text-lg">
                                            <div><span className="font-bold">ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ:</span> {getSelectedProject()?.name}</div>
                                            <div><span className="font-bold">ÿ±ŸÇŸÖ ÿßŸÑŸàÿ≠ÿØÿ©:</span> {unitNumber || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</div>
                                            <div><span className="font-bold">ŸÇŸäŸÖÿ© ÿßŸÑŸàÿ≠ÿØÿ©:</span> {formatCurrency(unitValue)}</div>
                                            <div><span className="font-bold">ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ≥ÿØÿßÿØ:</span> {results.patternName}</div>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div className="bg-white rounded-lg p-4 text-center shadow">
                                            <p className="text-sm text-gray-600 mb-1">ÿßŸÑŸÖŸÇÿØŸÖ</p>
                                            <p className="text-xl font-bold text-gray-800">{formatCurrency(results.downPayment)}</p>
                                        </div>
                                        <div className="bg-white rounded-lg p-4 text-center shadow">
                                            <p className="text-sm text-gray-600 mb-1">ÿßŸÑŸÇÿ≥ÿ∑ ÿßŸÑÿ£ŸàŸÑ</p>
                                            <p className="text-xl font-bold text-indigo-600">
                                                {formatCurrency(results.installmentAmount || results.baseInstallment || results.schedule[results.schedule.length - 1]?.amount || 0)}
                                            </p>
                                        </div>
                                        <div className="bg-white rounded-lg p-4 text-center shadow">
                                            <p className="text-sm text-gray-600 mb-1">ÿπÿØÿØ ÿßŸÑÿØŸÅÿπÿßÿ™</p>
                                            <p className="text-xl font-bold text-gray-800">{results.schedule.length - 1}</p>
                                        </div>
                                        <div className="bg-white rounded-lg p-4 text-center shadow">
                                            <p className="text-sm text-gray-600 mb-1">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿØŸÅŸàÿπ</p>
                                            <p className="text-xl font-bold text-gray-800">{formatCurrency(results.summary.totalPaid)}</p>
                                        </div>
                                    </div>

                                    {/* ADMIN ONLY: Technical Details */}
                                    {isAdmin && (
                                        <div className="mt-4 p-4 bg-white rounded-lg shadow print-hidden">
                                            <h3 className="font-bold text-gray-800 mb-2">üîç ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ™ÿ≠ŸÇŸÇ (ŸÑŸÑŸÖÿØŸäÿ± ŸÅŸÇÿ∑)</h3>
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                                <div>
                                                    <p className="text-gray-600">ŸÇŸäŸÖÿ© ÿßŸÑŸÉÿßÿ¥</p>
                                                    <p className="font-bold">{formatCurrency(results.verification.cashValue)}</p>
                                                </div>
                                                <div>
                                                    <p className="text-gray-600">XNPV ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ®ÿ©</p>
                                                    <p className="font-bold text-green-600">{formatCurrency(results.verification.totalPV)}</p>
                                                </div>
                                                <div>
                                                    <p className="text-gray-600">ÿßŸÑŸÅÿ±ŸÇ</p>
                                                    <p className={`font-bold ${Math.abs(results.verification.difference) < 1000 ? 'text-green-600' : 'text-red-600'}`}>
                                                        {formatCurrency(Math.abs(results.verification.difference))}
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-gray-600">ŸÖÿπÿØŸÑ ÿßŸÑÿÆÿµŸÖ</p>
                                                    <p className="font-bold text-indigo-600">
                                                        {getSelectedProject()?.discountRate.toFixed(3)}%
                                                        {getSelectedProject()?.discountRateMode === 'auto' && <span className="text-xs ml-1">(ŸÖÿ≠ÿ≥Ÿàÿ®)</span>}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Payment Schedule */}
                                <div className="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-gray-100 print-container">
                                    <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 print-hidden">
                                        <h3 className="text-xl font-bold text-white">üìã ÿ¨ÿØŸàŸÑ ÿßŸÑÿØŸÅÿπÿßÿ™</h3>
                                    </div>
                                    
                                    <div className="print-only bg-indigo-600 px-6 py-3">
                                        <h3 className="text-xl font-bold text-white">ÿ¨ÿØŸàŸÑ ÿßŸÑÿØŸÅÿπÿßÿ™ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä</h3>
                                    </div>

                                    <div className="p-6">
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead className="bg-gray-100">
                                                    <tr>
                                                        <th className="px-4 py-3 text-right font-bold border">ŸÖ</th>
                                                        <th className="px-4 py-3 text-right font-bold border">ÿßŸÑŸÜŸàÿπ</th>
                                                        <th className="px-4 py-3 text-right font-bold border">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                                                        <th className="px-4 py-3 text-right font-bold border">ÿßŸÑŸÖÿ®ŸÑÿ∫</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-200">
                                                    {results.schedule.map((payment) => (
                                                        <tr key={payment.id} className="hover:bg-gray-50">
                                                            <td className="px-4 py-3 border">{payment.id + 1}</td>
                                                            <td className="px-4 py-3 font-medium border">{payment.type}</td>
                                                            <td className="px-4 py-3 border">{formatDate(payment.date)}</td>
                                                            <td className="px-4 py-3 font-bold border">{formatCurrency(payment.amount)}</td>
                                                        </tr>
                                                    ))}
                                                    <tr className="bg-gray-200 font-bold">
                                                        <td colSpan="3" className="px-4 py-3 border">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</td>
                                                        <td className="px-4 py-3 border">{formatCurrency(results.summary.totalPaid)}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div className="print-only mt-8 pt-6 border-t-2 border-gray-300">
                                            <div className="grid grid-cols-2 gap-8">
                                                <div className="text-center">
                                                    <p className="mb-12">_____________________</p>
                                                    <p className="font-bold">ÿ™ŸàŸÇŸäÿπ ÿßŸÑÿπŸÖŸäŸÑ</p>
                                                </div>
                                                <div className="text-center">
                                                    <p className="mb-12">_____________________</p>
                                                    <p className="font-bold">ÿ™ŸàŸÇŸäÿπ ÿßŸÑÿ¥ÿ±ŸÉÿ©</p>
                                                </div>
                                            </div>
                                            <div className="text-center mt-8 text-sm text-gray-600">
                                                <p>ÿ¥ÿ±ŸÉÿ© ÿ®Ÿäÿ™ÿß ŸÑŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿπŸÇÿßÿ±Ÿä - BETA SMART FINANCE</p>
                                                <p className="mt-1">Ÿáÿßÿ™ŸÅ: 01000000000 - info@beta.com</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Enhanced Comparison Modal */}
                        <ComparisonModal />

                        {/* Footer */}
                        <div className="text-center text-gray-600 text-sm mt-8 pb-8 print-hidden">
                            <p className="font-bold text-indigo-600 text-lg">ÿ¥ÿ±ŸÉÿ© ÿ®Ÿäÿ™ÿß ŸÑŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿπŸÇÿßÿ±Ÿä</p>
                            <p className="mt-1">BETA SMART FINANCE | ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÇÿ≥Ÿäÿ∑ ÿßŸÑŸÖÿ±ŸÜ - ÿØŸÇÿ© ÿπÿßŸÑŸäÿ© - ÿÆÿØŸÖÿ© ŸÖÿ™ŸÖŸäÿ≤ÿ©</p>
                            <p className="mt-2">¬© 2025 ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<BetaSmartFinance />, document.getElementById('root'));
    </script>
</body>
</html>
